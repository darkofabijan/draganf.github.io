<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

  <title>Thunder - HTTP server with cowboy</title>
  <link rel="stylesheet" href="/stylesheets/default.css" type="text/css" media="screen" charset="utf-8" />
  <link rel="stylesheet" href="/stylesheets/syntax.css" type="text/css" media="screen" charset="utf-8" />
  <link rel="shortcut icon" type="image/png" href="favicon.png" />
  <link rel="alternate" type="application/rss+xml" title="thunder-ex.org" href="http://thunder-ex.org/feed.xml">

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47281287-1', 'thunder-ex.github.io');
  ga('send', 'pageview');
  </script>

</head>


<body>
  <div class = "site">
    <div span="title"><a href="/"><img src="/images/logo-icon.png" height="17"> Thunder</a> - Elixir Web Framework</div>

    <div id = 'post'><h1>HTTP server with cowboy</h1>

<p><small>On Sunday, January 19, 2014 by Darko Fabijan</small></p>

<p>As a first step I wanted to have working HTTP server. After a bit of research it turned out that <a href="https://github.com/extend/cowboy">cowboy</a> is a good library to go with. It is well maintained and has support for Websockets, chunked responses, SPDY, and so on. Documentation is also quite nice and I really liked <a href="http://ninenines.eu/docs/%20en/cowboy/HEAD/guide/">Cowboy User Guide</a> which is still work in progress but has enough information already to get you started with cowboy.</p>

<p>The <a href="https://github.com/thunder-ex/thunder/commit/b977e5a88c42a4caa7eff951ccfabf1efda48775">initial commit</a> is just freshly generated Elixir application. In the <a href="https://github.com/thunder-ex/thunder/commit/b64e872faa4ac66c454e5cd6bed14ee6f5fd1aa3">second commit</a> I have added cowboy. <a href="https://github.com/joshrotenberg">John Rotenberg</a> translated cowboy examples into Elixir and the <a href="https://github.com/joshrotenberg/elixir_cowboy_examples">repository</a> is available on GitHub. So introducing cowboy was pretty much reorganising his hello world example.</p>

<p>I wrapped cowboy in <code>Thunder.HttpServer</code> module so only <a href="https://github.com/thunder-ex/thunder/commit/7a33a36d6313f8904089afa374b5c51694c3192c#diff-ccbbcc6457dfea4c7a0787e60b0dd04fR7">one line</a> <code>Thunder.HttpServer.run</code> needs to be added to our main application file. And since cowboy is separate application it needs to be started with our app and that's done by adding [<code>applications [:cowboy]</code> to mix file.</p>

<p>The most important part is <code>Thunder.RequestHandler</code>. This is the entry point of a request into our application. In <code>handle(req, state)</code> function we currently just extract request path, compose response message and call <code>reply</code> function on cowboy request. All the interesting things will be happening in this function. It's <code>int main()</code> of framework (it's just my C background speaking).</p>

<div class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="kd">defmodule</span> <span class="nc">Thunder.RequestHandler</span> <span class="k">do</span>

  <span class="kd">def</span> <span class="n">init</span><span class="p">({</span><span class="n">_any</span><span class="p">,</span> <span class="ss">:http</span><span class="p">},</span> <span class="n">req</span><span class="p">,</span> <span class="p">[])</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="ss">:undefined</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="kd">def</span> <span class="n">handle</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="n">path</span><span class="p">,</span> <span class="bp">_</span><span class="p">}</span> <span class="p">=</span> <span class="ss">:cowboy_req</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="n">response</span> <span class="p">=</span> <span class="s2">&quot;You have requested: </span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="ss">:cowboy_req</span><span class="p">.</span><span class="n">reply</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">[],</span> <span class="n">response</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">state</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="kd">def</span> <span class="n">terminate</span><span class="p">(</span><span class="n">_reason</span><span class="p">,</span> <span class="n">_req</span><span class="p">,</span> <span class="n">_state</span><span class="p">)</span> <span class="k">do</span>
    <span class="ss">:ok</span>
  <span class="k">end</span>

<span class="k">end</span></code></pre></div>


<p>For the following posts I plan to create pull requests so it would be issier to reference and discuss code.</p>
</div>

    <div id="disqus_thread"></div>
<script type="text/javascript">
     /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
     var disqus_shortname = 'thunder-ex'; // required: replace example with your forum shortname

     /* * * DON'T EDIT BELOW THIS LINE * * */
     (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
 </script>
 <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



    <div class='footer'>
  <div class="contact">
    <p>
      Thunder is released under the MIT license.<br/>
      <small>Site is built using <a href="http://jekyllrb.com" class="silent">Jekyll</a> and theme created by <a href="http://michaelrbernste.in/" class="silent">Michael Robert Bernstein</a>. It's <a href="https://github.com/thunder-ex/thunder-ex.github.io" class="silent">open-source</a>.</small>
    </p>
  </div>
</div>


  </div>
</body>

</html>
